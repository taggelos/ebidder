<?xml version='1.0' encoding='UTF-8' ?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:f="http://java.sun.com/jsf/core">
    <h:head>
        <title>Chat test!</title>
		<h:outputStylesheet name="newcss.css" library="css"/>
    </h:head>

    <h:body> 
		
		<h:form>
	   		<h:commandButton value="Incomming" action="#{conversation_list.setIncoming()}" />
	   		<h:commandButton value="Outcoming" action="#{conversation_list.setOutcoming()}" />				
		</h:form>
		
			
		<h:outputText value="Incoming" rendered="#{conversation_list.isIncoming() eq true}" style="font-weight:bold"/>	
		<h:outputText value="Outcoming" rendered="#{conversation_list.isIncoming()eq false}" style="font-weight:bold"/>	
				
		<script type="text/javascript">
		    setInterval(function() { 
		        document.getElementById('myForm:btnLoadData').click();
		        }, 1000);
		</script>

		<h:form id="myForm">
		    <h:commandButton id="btnLoadData" value="Hidden" 
		        style="display:none">
		        <f:ajax execute="@form" render=":ConversationListForm" />
		    </h:commandButton>
		</h:form>		
				
		<h:form id="ConversationListForm">
			<h:dataTable id="ConversationList" value="#{ conversation_list.conversationList }" var="conv"	
			styleClass="userTable" headerClass="userTableHeader"
			rowClasses="userTableOddRow,userTableEvenRow">  
			
				<h:column>
				<f:facet name="header">Time</f:facet>
					[#{conv.getTime()}]	
				</h:column>				
				<h:column>
					:
				</h:column>							
				<h:column rendered="#{conversation_list.isIncoming()  eq true}" >   
				<f:facet name="header">Sender</f:facet> 
					 <b>#{conv.user1.name}</b>
				</h:column>
				<h:column rendered="#{conversation_list.isIncoming()eq false}"  >   
				<f:facet name="header">Sender</f:facet> 
					 <b>#{conv.user2.name}</b>
				</h:column>
				<h:column>
					:
				</h:column>							
				<h:column>   
				<f:facet name="header">Message</f:facet> 
					 #{conv.text}
				</h:column>
				<h:column rendered="#{conversation_list.isIncoming() eq true}" >
					<h:commandButton value="See All" action="#{ conversation_list.see_all }">
						<f:setPropertyActionListener target="#{message.receiver}"
						value="#{conv.user1}" />
					</h:commandButton>
				</h:column>
				<h:column rendered="#{conversation_list.isIncoming()eq false}">
					<h:commandButton value="See All" action="#{ conversation_list.see_all }">
						<f:setPropertyActionListener target="#{message.receiver}"
						value="#{conv.user2}" />
					</h:commandButton>
				</h:column>
				<h:column>
					<h:commandButton value="Delete" action="#{ conversation_list.delete() }">
						<f:setPropertyActionListener target="#{conversation_list.conversation_for_delete}"
						value="#{conv}" />
					</h:commandButton>
				</h:column>				
			</h:dataTable>
		</h:form>
		

    </h:body>
</html>